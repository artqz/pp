(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{101:function(e,t,a){e.exports=a(194)},190:function(e,t,a){},191:function(e,t,a){},192:function(e,t,a){},193:function(e,t,a){},194:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(24),o=a.n(c),s=a(25),i=a(196),l=a(195),u=Object(n.createContext)({player:{loading:!0,canplay:!1,path:null},items:[]}),m=a(26),f=function(e,t){switch(t.type){case"SET_LIST":return Object(m.a)({},e,{list:t.list});case"GET_TRACK":return Object(m.a)({},e,{link:t.link});case"PLAY_TRACK":return Object(m.a)({},e,{playing:t.playing});case"NEXT_TRACK":var a;return a=e.list.length>e.currentTrack+1?e.currentTrack+1:0,Object(m.a)({},e,{currentTrack:a});case"PREV_TRACK":var n;return n=0>e.currentTrack-1?e.list.length-1:e.currentTrack-1,Object(m.a)({},e,{currentTrack:n});case"SELECT_TRACK":return Object(m.a)({},e,{currentTrack:t.trackId});case"SWITCH_THEME":return Object(m.a)({},e,{theme:t.theme});default:return e}},d=a(32),p=a(33),h=a(35),b=a(34),g=a(36),E=a(197),v=function(e){function t(){return Object(d.a)(this,t),Object(h.a)(this,Object(b.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){if(""!==this.props.location.hash){var e=/access_token=([^&]+)/.exec(this.props.location.hash)[1],t=/token_type=([^&]+)/.exec(this.props.location.hash)[1],a=/expires_in=([^&]+)/.exec(this.props.location.hash)[1];localStorage.setItem("yd_access_token",e),localStorage.setItem("yd_token_type",t),localStorage.setItem("yd_expires_in",a),window.location.hash=""}}},{key:"render",value:function(){return r.a.createElement(E.a,{to:"/"})}}]),t}(n.Component),y=function(e){function t(){return Object(d.a)(this,t),Object(h.a)(this,Object(b.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){if(""!==this.props.location.hash){var e=/access_token=([^&]+)/.exec(this.props.location.hash)[1],t=/token_type=([^&]+)/.exec(this.props.location.hash)[1];localStorage.setItem("db_access_token",e),localStorage.setItem("db_token_type",t),window.location.hash=""}}},{key:"render",value:function(){return r.a.createElement(E.a,{to:"/"})}}]),t}(n.Component),_=a(43),k=a.n(_);var j=a(100);a(189),a(190);var T=function(e){var t=e.list,a=Object(n.useContext)(u),c=a.state,o=a.dispatch,s=Object(n.useRef)();return Object(n.useEffect)(function(){s.current.scrollToRow(c.currentTrack)},[c.currentTrack]),r.a.createElement("div",{className:"track_list"},r.a.createElement(j.a,{ref:s,width:400,height:400,rowCount:t.length,rowHeight:35,rowRenderer:function(e){var a=e.key,n=e.index,s=(e.isScrolling,e.isVisible,e.style);return r.a.createElement("div",{key:a,style:s,className:c.currentTrack===n?"track current_track":"track",onDoubleClick:function(){return function(e){o({type:"SELECT_TRACK",trackId:e})}(n)}},t[n].name)}}))},O=function(e){function t(){return Object(d.a)(this,t),Object(h.a)(this,Object(b.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(p.a)(t,[{key:"onPrev",value:function(){this.props.onPrev()}},{key:"onNext",value:function(){this.props.onNext()}},{key:"onPlay",value:function(){this.props.onPlay()}},{key:"render",value:function(){var e=this.props,t=e.isPlaying,a=e.loading;return r.a.createElement("div",{className:"controls"},r.a.createElement("span",{className:a?"controls_btn loading":"controls_btn",onClick:this.onPrev.bind(this)},r.a.createElement("i",{className:"fas fa-fast-backward"})),r.a.createElement("span",{className:a?"controls_btn loading":"controls_btn",onClick:this.onPlay.bind(this)},t?r.a.createElement("i",{className:"fas fa-pause"}):r.a.createElement("i",{className:"fas fa-play"})),r.a.createElement("span",{className:a?"controls_btn loading":"controls_btn",onClick:this.onNext.bind(this)},r.a.createElement("i",{className:"fas fa-fast-forward"})))}}]),t}(n.Component);function w(e){var t=Math.floor(e/3600),a=Math.floor(e/60)-60*t,n=Math.floor(e)-60*a-3600*t;return t?t+":"+N(a)+":"+N(n):a+":"+N(n)}function N(e){var t=e+"";return 1===t.length?"0"+t:0===t.length?"00":t}var S=r.a.forwardRef(function(e,t){return r.a.createElement("div",{ref:t,className:"progress",onMouseDown:function(t){return e.changeProgress(t)}},r.a.createElement("div",{className:"progress_bg"}),r.a.createElement("div",{className:"progress_bar progress_buffered"},r.a.createElement("div",{className:"progress_line",style:{width:e.buffered+"%"}})),r.a.createElement("div",{className:"progress_bar progress_reproduced"},r.a.createElement("div",{className:"progress_line",style:{width:e.progress+"%"}})),r.a.createElement("div",{className:"progress_bar progress_text"},r.a.createElement("div",{className:"progress_left"},e.currentTime?w(e.currentTime):null),r.a.createElement("div",{className:"progress_right"},e.duration?w(e.duration):null)))}),C=(a(191),function(e){var t=Object(n.useContext)(u),a=t.state,c=t.dispatch,o=Object(n.useState)(!1),i=Object(s.a)(o,2),l=i[0],m=i[1],f=Object(n.useRef)(),d=Object(n.useRef)(),p=function(e){var t=Object(n.useState)(0),a=Object(s.a)(t,2),r=a[0],c=a[1],o=function(){c(e.current.duration)};return Object(n.useEffect)(function(){return e.current.addEventListener("loadedmetadata",o),function(){e.current.removeEventListener("loadedmetadata",o)}},[o]),{duration:r,setDuration:c}}(f),h=p.duration,b=(p.setDuration,function(e,t,a){var r=Object(n.useState)(0),c=Object(s.a)(r,2),o=c[0],i=c[1],l=Object(n.useState)(0),u=Object(s.a)(l,2),m=u[0],f=u[1],d=Object(n.useState)(0),p=Object(s.a)(d,2),h=p[0],b=p[1],g=function(){if(e.current.duration>0){i(e.current.currentTime),a||f(e.current.currentTime/e.current.duration*100);for(var t=0;t<e.current.buffered.length;t++)if(e.current.buffered.start(e.current.buffered.length-1-t)<e.current.currentTime){b(e.current.buffered.end(e.current.buffered.length-1-t)/e.current.duration*100);break}}};return Object(n.useEffect)(function(){return e.current.addEventListener("timeupdate",g),function(){e.current.removeEventListener("timeupdate",g)}},[t,g,a]),{currentTime:o,progress:m,buffer:h,setCurrentTime:i,setProgress:f,setBuffer:b}}(f,_,l)),g=b.currentTime,E=b.progress,v=b.buffer,y=(b.setCurrentTime,b.setProgress);b.setBuffer;function _(){c({type:"PLAY_TRACK",playing:!a.playing})}function j(){f.current.pause(),c({type:"NEXT_TRACK"})}return function(e,t,a){var r=function(n){var r;e&&(r=n.clientX>t.current.clientWidth?100:n.clientX<0?0:n.clientX/t.current.clientWidth*100,a(r))};Object(n.useEffect)(function(){return window.addEventListener("mousemove",r),function(){window.removeEventListener("mousemove",r)}},[e,r])}(l,d,y),function(e,t,a,r,c){var o=function(){r&&(c(!1),e.current.currentTime=t/100*a)};Object(n.useEffect)(function(){return window.addEventListener("mouseup",o),function(){window.removeEventListener("mouseup",o)}},[t,r,o])}(f,E,h,l,m),Object(n.useEffect)(function(){(function(e){var t={headers:{Authorization:"Bearer "+localStorage.getItem("db_access_token"),Accept:"application/json"}},a={path:e};return k.a.post("https://api.dropboxapi.com/2/files/get_temporary_link",a,t)})(e.track).then(function(e){c({type:"GET_TRACK",link:e.data.link})})},[e.track]),Object(n.useEffect)(function(){a.playing?f.current.play():f.current.pause()},[a.playing]),r.a.createElement("div",{className:"player"},r.a.createElement(S,{ref:d,progress:E,buffered:v,currentTime:g,duration:h,changeProgress:function(e){y(e.clientX/d.current.clientWidth*100),m(!0)}}),r.a.createElement(O,{isPlaying:a.playing,loading:!0,onPrev:function(){f.current.pause(),c({type:"PREV_TRACK"})},onNext:j,onPlay:_}),r.a.createElement("audio",{ref:f,src:a.link,autoPlay:a.playing,onEnded:j}))});var x=function(){var e=Object(n.useContext)(u),t=e.state,a=e.dispatch;return Object(n.useEffect)(function(){if(console.log("Player status:"),localStorage.getItem("db_access_token")){console.log("- Dropbox token found!");var e=[];console.log("- Start searching for tracks..."),function(e){var t={headers:{Authorization:"Bearer "+localStorage.getItem("db_access_token"),Accept:"application/json"}};return k.a.post("https://api.dropboxapi.com/2/files/search",{path:"",query:"*.mp3",start:0,max_results:1e3,mode:"filename"},t)}(localStorage.getItem("db_access_token")).then(function(t){t.data.matches.map(function(t){return"file"===t.metadata[".tag"]&&e.push({name:t.metadata.name,path:t.metadata.path_display,provider:"dropbox",playing:!1}),e}),console.log("- Found "+e.length+" tracks!"),a({type:"SET_LIST",list:e})})}},[]),t.list[t.currentTrack]?r.a.createElement("div",null,r.a.createElement(T,{list:t.list}),r.a.createElement(C,{track:t.list[t.currentTrack].path})):null};var I=function(e){var t=Object(n.useContext)(u),a=t.state,c=t.dispatch;return Object(n.useEffect)(function(){localStorage.getItem("theme")||localStorage.setItem("theme","day"),"night"===localStorage.getItem("theme")&&document.body.classList.add("night")}),Object(n.useEffect)(function(){c({type:"SWITCH_THEME",theme:localStorage.getItem("theme")})},[c]),r.a.createElement("div",{className:"switchTheme",onClick:function(){"day"===localStorage.getItem("theme")?(localStorage.setItem("theme","night"),document.body.classList.add("night"),c({type:"SWITCH_THEME",theme:"night"})):(localStorage.setItem("theme","day"),document.body.classList.remove("night"),c({type:"SWITCH_THEME",theme:"day"}))}},"day"===a.theme?r.a.createElement("i",{className:"far fa-sun"}):r.a.createElement("i",{className:"far fa-moon"}))};a(192);var P=function(){localStorage.getItem("yd_access_token");var e=localStorage.getItem("db_access_token");return r.a.createElement("div",{className:"navbar"},r.a.createElement("div",{className:"logo"},r.a.createElement("span",{className:"first_letter"},"D"),"rop",r.a.createElement("span",{className:"first_letter"},"P"),"rop",r.a.createElement("span",{className:"first_letter"},"P"),"lay"),e?null:r.a.createElement("a",{href:"https://www.dropbox.com/oauth2/authorize?client_id=3sf5dug4qbt4hbf&response_type=token&redirect_uri=".concat("https://serov112.ru/dropbox/callback")},"\u0414\u0440\u043e\u043f\u0431\u043e\u043a\u0441"),r.a.createElement(I,null))};a(193);var R=function(){var e=Object(n.useReducer)(f,{theme:"day",currentTrack:0,link:null,loading:!0,playing:!1,list:[]}),t=Object(s.a)(e,2),a=t[0],c=t[1];return r.a.createElement(i.a,null,r.a.createElement(u.Provider,{value:{state:a,dispatch:c}},r.a.createElement("div",{className:"app"},r.a.createElement(P,null),r.a.createElement(l.a,{exact:!0,path:"/",component:x}),r.a.createElement(l.a,{path:"/yandex/callback",component:v}),r.a.createElement(l.a,{path:"/dropbox/callback",component:y}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(R,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[101,1,2]]]);
//# sourceMappingURL=main.f2feda90.chunk.js.map